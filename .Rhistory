sets <- data.frame(
set_id = c("PW001", "PW002"),
set_name = c("Glycolysis", "TCA Cycle"),
feature_ids = c("HMDB0000060;HMDB0000122", "HMDB0000209;HMDB0000210"),
description = c("Energy metabolism", "Mitochondrial cycle")
)
Eset <- EnrichmentSet(sets, meta)
show(Eset)
summary(Eset)
# Convert to list for ORA/QEA functions
sets_list <- as(Eset, "list")
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
# Convert to list for ORA/QEA functions
sets_list <- as(Eset, "list")
str(sets_list)
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
feature_species = "Homo sapiens",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
selected <- c("HMDB0000161", "HMDB0000284", "HMDB0001820")
res <- ora_test(Eset, selected, test = "fisher")
print(res)
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
feature_species = "Homo sapiens",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
selected <- c("HMDB0000161", "HMDB0000284", "HMDB0001820")
res <- ora_test(Eset, selected)
plot_enrichment(res, type = "bar")
plot_enrichment(res, type = "dot")
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_enrichment.R", echo = TRUE)
plot_enrichment(res, type = "bar")
plot_enrichment(res, type = "dot")
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
# Vector de scores (p.ex. correlacions o loadings)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
res_qsea <- qea_test(Eset, scores, nperm = 1000)
print(res_qsea)
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
# Perfil d’enriquiment per al conjunt "Amino Acids"
plot_qsea_profile(Eset, scores, set_names = "Amino Acids")
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/dev/4-test_plot_qea_profile.R", echo = TRUE)
# Perfil d’enriquiment per al conjunt "Amino Acids"
plot_qsea_profile(Eset, scores, set_names = "Amino Acids")
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_qsea_profile.R", echo = TRUE)
# Perfil d’enriquiment per al conjunt "Amino Acids"
plot_qsea_profile(Eset, scores, set_names = "Amino Acids")
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
qea_profile <- function(eset, scores, set_name) {
if (!inherits(eset, "EnrichmentSet")) stop("Input must be an EnrichmentSet.")
sets_list <- as(eset, "list")
if (!(set_name %in% names(sets_list)))
stop("Specified set_name not found in EnrichmentSet.")
hits <- sets_list[[set_name]]
df <- data.frame(
feature = names(sort(scores, decreasing = TRUE)),
score = sort(scores, decreasing = TRUE)
)
df$hit <- ifelse(df$feature %in% hits, 1, 0)
Nh <- sum(df$hit)
N <- nrow(df)
if (Nh == 0) stop("No hits for this set in scores.")
running_score <- cumsum(df$hit / Nh - (!df$hit) / (N - Nh))
data.frame(
position = seq_len(N),
running_score = running_score,
hit = df$hit
)
}
profile_df <- qea_profile(Eset, scores, set_name = "Amino Acids")
p <- plot_qsea_profile(
profile_df,
set_name = "Amino Acids",
highlight = "#4E79A7",
rug_color = "black"
)
p
plot_qsea_profile(Eset, scores, set_names = "Amino Acids")
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
qea_profile <- function(eset, scores, set_name) {
if (!inherits(eset, "EnrichmentSet")) stop("Input must be an EnrichmentSet.")
sets_list <- as(eset, "list")
if (!(set_name %in% names(sets_list)))
stop("Specified set_name not found in EnrichmentSet.")
hits <- sets_list[[set_name]]
df <- data.frame(
feature = names(sort(scores, decreasing = TRUE)),
score = sort(scores, decreasing = TRUE)
)
df$hit <- ifelse(df$feature %in% hits, 1, 0)
Nh <- sum(df$hit)
N <- nrow(df)
if (Nh == 0) stop("No hits for this set in scores.")
running_score <- cumsum(df$hit / Nh - (!df$hit) / (N - Nh))
data.frame(
position = seq_len(N),
running_score = running_score,
hit = df$hit
)
}
profile_df <- qea_profile(Eset, scores, set_name = "Amino Acids")
p <- plot_qsea_profile(
profile_df,
set_name = "Amino Acids",
highlight = "#4E79A7",
rug_color = "black"
)
p
Eset_small <- filter_sets_by_features(Eset, names(scores))
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/filter_sets_by_features.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/prepare_features_list.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/qea_test.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_qsea_profile.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_enrichment.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
qea_profile <- function(eset, scores, set_name) {
if (!inherits(eset, "EnrichmentSet")) stop("Input must be an EnrichmentSet.")
sets_list <- as(eset, "list")
if (!(set_name %in% names(sets_list)))
stop("Specified set_name not found in EnrichmentSet.")
hits <- sets_list[[set_name]]
df <- data.frame(
feature = names(sort(scores, decreasing = TRUE)),
score = sort(scores, decreasing = TRUE)
)
df$hit <- ifelse(df$feature %in% hits, 1, 0)
Nh <- sum(df$hit)
N <- nrow(df)
if (Nh == 0) stop("No hits for this set in scores.")
running_score <- cumsum(df$hit / Nh - (!df$hit) / (N - Nh))
data.frame(
position = seq_len(N),
running_score = running_score,
hit = df$hit
)
}
profile_df <- qea_profile(Eset, scores, set_name = "Amino Acids")
p <- plot_qsea_profile(
profile_df,
set_name = "Amino Acids",
highlight = "#4E79A7",
rug_color = "black"
)
p
Eset_small <- filter_sets_by_features(Eset, names(scores))
# Fem el test
res_qea <- qea_test(Eset_small, scores, return_profiles = TRUE)
q()
q
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/qea_test.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_qsea_profile.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/filter_sets_by_features.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/plot_qsea_profile.R", echo = TRUE)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/qea_test.R", echo = TRUE)
Eset_small <- filter_sets_by_features(Eset, names(scores))
meta <- list(
mapping_name = "chemical_classes",
feature_id_type = "HMDB_ID",
set_source = "MEGA",
version = "v2025.1",
description = "Chemical classes mapping"
)
sets <- data.frame(
set_id = c("CL001", "CL002", "CL003"),
set_name = c("Amino Acids", "Biogenic Amines", "Lipids"),
feature_ids = c(
"HMDB0000161;HMDB0000191;HMDB0000243;HMDB0000284",
"HMDB0001432;HMDB0001448;HMDB0001820",
"HMDB0000221;HMDB0000562;HMDB0000625;HMDB0000933"
)
Eset <- EnrichmentSet(sets, meta)
scores <- c(
HMDB0000161 = 0.35, HMDB0000191 = 0.42,
HMDB0000243 = 0.12, HMDB0000284 = 0.29,
HMDB0001432 = -0.25, HMDB0001448 = -0.32,
HMDB0001820 = -0.18, HMDB0000221 = 0.10,
HMDB0000562 = 0.05, HMDB0000625 = -0.02,
HMDB0000933 = -0.11
)
qea_profile <- function(eset, scores, set_name) {
if (!inherits(eset, "EnrichmentSet")) stop("Input must be an EnrichmentSet.")
sets_list <- as(eset, "list")
if (!(set_name %in% names(sets_list)))
stop("Specified set_name not found in EnrichmentSet.")
hits <- sets_list[[set_name]]
df <- data.frame(
feature = names(sort(scores, decreasing = TRUE)),
score = sort(scores, decreasing = TRUE)
)
df$hit <- ifelse(df$feature %in% hits, 1, 0)
Nh <- sum(df$hit)
N <- nrow(df)
if (Nh == 0) stop("No hits for this set in scores.")
running_score <- cumsum(df$hit / Nh - (!df$hit) / (N - Nh))
data.frame(
position = seq_len(N),
running_score = running_score,
hit = df$hit
)
}
profile_df <- qea_profile(Eset, scores, set_name = "Amino Acids")
p <- plot_qsea_profile(
profile_df,
set_name = "Amino Acids",
highlight = "#4E79A7",
rug_color = "black"
)
p
Eset_small <- filter_sets_by_features(Eset, names(scores))
res_qea <- qea_test(Eset_small, scores, min_set_size = 2, return_profiles = TRUE, nperm = 1000)
# resum top categories
plot_enrichment(res_qea$table, type = "dot")
# un set concret
plot_qea_profile(res_qea, sets = "Amino Acids", show = "selected", facet = TRUE)
# tots els significatius
plot_qea_profile(res_qea, show = "significant", p_cutoff = 0.25)  # ajusta el llindar per l’exemple
# un set concret
plot_qea_profile(res_qea, sets = "Amino Acids", show = "selected", facet = TRUE)
# tots els significatius
plot_qea_profile(res_qea, show = "significant", p_cutoff = 0.25)  # ajusta el llindar per l’exemple
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/prepare_features_list.R", echo = TRUE)
features_example <- data.frame(
Feature_ID = paste0("HMDB0000", 161:170),
correlation = c(0.35, 0.42, 0.12, 0.29, -0.25, -0.32, -0.18, 0.10, 0.05, -0.02),
p.adj = c(0.01, 0.04, 0.30, 0.10, 0.25, 0.60, 0.80, 0.05, 0.90, 0.40),
chemical_families = rep(c("Amino Acids", "Biogenic Amines"), each = 5)
)
prepare_features_list(features_example, fdr_cutoff = 0.25, cor_cutoff = 0.1)
require(dplyr)
prepare_features_list(features_example, fdr_cutoff = 0.25, cor_cutoff = 0.1)
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::load_all()
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
devtools::load_all()
devtools::document()
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
devtools::document()
devtools::load_all()
rm(list = c("EnrichmentSet"))
devtools::load_all()
devtools::document()
rm(list = c("EnrichmentSet"))
devtools::load_all()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::load_all()
devtools::document()
devtools::check()
devtools::load_all()
devtools::document()
devtools::check()
devtools::load_all()
devtools::document()
devtools::check()
rmarkdown::render("README.Rmd")
rmarkdown::render("README.md")
git add .
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
hmdb_study <- unique(myProject_map$HMDB)
load(file="./inst/extdata/myProject_map.Rda")
head(myProject_map[,1:6])
hmdb_study <- unique(myProject_map$HMDB)
# Filter the SMPDB enrichment set
SMPDBset_filtered <- filterEnrichmentSet(SMPDBset, hmdb_study)
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-class.R", echo = TRUE)
# Filter the SMPDB enrichment set
SMPDBset_filtered <- filterEnrichmentSet(SMPDBset, hmdb_study)
load("./inst/exdata/smpdb_pathway.rda")
load("./inst/extdata/smpdb_pathway.rda")
SMPDBset <- as.EnrichmentSet.list(smpdb_pathway)
summary(SMPDBset)
hmdb_study <- unique(myProject_map$HMDB)
# Filter the SMPDB enrichment set
SMPDBset_filtered <- filterEnrichmentSet(SMPDBset, hmdb_study)
summary(SMPDBset_filtered)
SMPDBset_filtered<- as.data.frame(SMPDBset_filtered)
head(SMPDBset_filtered)
meta_df <- data.frame(
HMDB = c("HMDB0000060", "HMDB0000122", "HMDB0000209", "HMDB0000210"),
Pathway = c("Glycolysis", "Glycolysis", "TCA Cycle", "TCA Cycle")
)
Eset <- buildEnrichmentSet(
data = meta_df,
id_col = "HMDB",
category_col = "Pathway",
set_name = "SMPDB_pathways",
source = "SMPDB",
species = "Homo sapiens",
version = "2024-05",
description = "Metabolic pathways curated from SMPDB"
)
show(Eset)
summary(Eset)
as.data.frame(Eset)
devtools::load_all()
devtools::document()
pkgload::dev_help('filterEnrichmentSet')
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::load_all()
detach("package::localEnrichment")
detach("package:localEnrichment")
devtools::load_all()
exists("as.EnrichmentSet.list")
source("C:/Users/Usuario/Dropbox (Personal)/SotaCV/localEnrichment/R/EnrichmentSet-utils.R", echo = TRUE)
devtools::document()
devtools::check()
devtools::document()
remove.packages("localEnrichment")
remotes::install_github("aspresearch/localEnrichment")
library(localEnrichmentR)
library(localEnrichment)
ls("package:localEnrichment")
test_ES <- EnrichmentSet(
mapping = tibble(
set_id = "X",
set_name = "Test pathway",
feature_ids = "HMDB00001"
),
metadata = list(
mapping_name = "test",
feature_id_type = "HMDB",
feature_species = "human",
set_source = "manual",
version = "1.0",
description = "test"
),
sep = ";"
)
EnrichmentSet
ES_SMPDB_HMDB <- EnrichmentSet(
SMPDB_path2hmdb %>%
transmute(
set_id    = pathway,
set_name  = pathway,
feature_ids = HMDB
),
metadata = list(
mapping_name = "SMPDB_HMDB",
feature_id_type = "HMDB",
feature_species = "human",
set_source = "SMPDB",
version = "1.0",
description = "SMPDB pathways (HMDB IDs)"
),
sep = ";"
)
library(dplyr)
ES_SMPDB_HMDB <- EnrichmentSet(
SMPDB_path2hmdb %>%
transmute(
set_id    = pathway,
set_name  = pathway,
feature_ids = HMDB
),
metadata = list(
mapping_name = "SMPDB_HMDB",
feature_id_type = "HMDB",
feature_species = "human",
set_source = "SMPDB",
version = "1.0",
description = "SMPDB pathways (HMDB IDs)"
),
sep = ";"
)
